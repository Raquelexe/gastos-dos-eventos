<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de C√°lculo de Custo de Sinaliza√ß√£o</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 30px;
    min-height: 100vh;
  }
  
  .container {
    max-width: 900px;
    margin: auto;
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  }
  
  h1 {
    text-align: center;
    color: #333;
    margin-bottom: 30px;
    padding-bottom: 15px;
    border-bottom: 3px solid #667eea;
  }
  
  .section {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 25px;
    border-left: 5px solid #667eea;
  }
  
  .section-title {
    color: #667eea;
    margin-top: 0;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .section-title i {
    font-size: 24px;
  }
  
  .grid-2 {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 15px;
  }
  
  .grid-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-bottom: 15px;
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
  }
  
  label {
    margin-bottom: 8px;
    font-weight: 600;
    color: #555;
    font-size: 14px;
  }
  
  input, select {
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.3s;
  }
  
  input:focus, select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 16px 30px;
    font-size: 16px;
    font-weight: 600;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s;
    width: 100%;
    margin-top: 20px;
  }
  
  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 7px 20px rgba(102, 126, 234, 0.4);
  }
  
  button:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }
  
  .material-card {
    background: white;
    padding: 15px;
    border-radius: 8px;
    border: 2px solid #e8eaf6;
    transition: all 0.3s;
  }
  
  .material-card:hover {
    border-color: #667eea;
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
  }
  
  #mensagem {
    margin-top: 25px;
    padding: 20px;
    border-radius: 10px;
    display: none;
    font-weight: 600;
    font-size: 15px;
    text-align: center;
  }
  
  .sucesso {
    background: #e8f5e9;
    color: #2e7d32;
    border: 2px solid #c8e6c9;
  }
  
  .erro {
    background: #ffebee;
    color: #c62828;
    border: 2px solid #ffcdd2;
  }
  
  .info {
    background: #e3f2fd;
    color: #1565c0;
    border: 2px solid #bbdefb;
  }
  
  .link-planilha {
    display: inline-block;
    margin-top: 10px;
    padding: 10px 15px;
    background: #4285f4;
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-size: 14px;
    transition: all 0.3s;
  }
  
  .link-planilha:hover {
    background: #3367d6;
  }
  
  .counter {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
  }
  
  .counter button {
    width: 40px;
    height: 40px;
    padding: 0;
    margin: 0;
    font-size: 20px;
  }
  
  .counter input {
    width: 80px;
    text-align: center;
  }
</style>
</head>
<body>

<div class="container">
  <h1>üìã C√°lculo de Custo de Sinaliza√ß√£o para Eventos</h1>
  
  <form id="formEvento">
    
    <div class="section">
      <h2 class="section-title">üìÑ DADOS DO EVENTO</h2>
      <div class="grid-2">
        <div class="form-group">
          <label>üîñ Protocolo</label>
          <input type="text" name="protocolo" required placeholder="Ex: EV-2024-001">
        </div>
        <div class="form-group">
          <label>üìÖ Data do Evento</label>
          <input type="date" name="data_evento" required>
        </div>
        <div class="form-group">
          <label>üè∑Ô∏è Nome do Evento</label>
          <input type="text" name="evento" required placeholder="Nome completo do evento">
        </div>
        <div class="form-group">
          <label>üìç Local do Evento</label>
          <input type="text" name="local" required placeholder="Endere√ßo completo">
        </div>
      </div>
    </div>
    
    <div class="section">
      <h2 class="section-title">üõ†Ô∏è PLACAS DE SINALIZA√á√ÉO</h2>
      <div class="grid-3">
        <div class="material-card">
          <label>Placa R-4a</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="r4a">-</button>
            <input type="number" name="r4a" min="0" value="0">
            <button type="button" class="increment" data-field="r4a">+</button>
          </div>
        </div>
        <div class="material-card">
          <label>Placa R-4b</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="r4b">-</button>
            <input type="number" name="r4b" min="0" value="0">
            <button type="button" class="increment" data-field="r4b">+</button>
          </div>
        </div>
        <div class="material-card">
          <label>Placa R-6a</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="r6a">-</button>
            <input type="number" name="r6a" min="0" value="0">
            <button type="button" class="increment" data-field="r6a">+</button>
          </div>
        </div>
        <div class="material-card">
          <label>Placa R-6c</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="r6c">-</button>
            <input type="number" name="r6c" min="0" value="0">
            <button type="button" class="increment" data-field="r6c">+</button>
          </div>
        </div>
        <div class="material-card">
          <label>Placa R-25a</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="r25a">-</button>
            <input type="number" name="r25a" min="0" value="0">
            <button type="button" class="increment" data-field="r25a">+</button>
          </div>
        </div>
        <div class="material-card">
          <label>Placa R-25b</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="r25b">-</button>
            <input type="number" name="r25b" min="0" value="0">
            <button type="button" class="increment" data-field="r25b">+</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="section">
      <h2 class="section-title">üöß EQUIPAMENTOS DE SINALIZA√á√ÉO</h2>
      <div class="grid-3">
        <div class="material-card">
          <label>Cone</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="cone">-</button>
            <input type="number" name="cone" min="0" value="0">
            <button type="button" class="increment" data-field="cone">+</button>
          </div>
        </div>
        <div class="material-card">
          <label>Cavalete</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="cavalete">-</button>
            <input type="number" name="cavalete" min="0" value="0">
            <button type="button" class="increment" data-field="cavalete">+</button>
          </div>
        </div>
        <div class="material-card">
          <label>Fita Zebra (metros)</label>
          <input type="number" name="fita" min="0" value="0" placeholder="Metros">
        </div>
        <div class="material-card">
          <label>Barreira</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="barreira">-</button>
            <input type="number" name="barreira" min="0" value="0">
            <button type="button" class="increment" data-field="barreira">+</button>
          </div>
        </div>
        <div class="material-card">
          <label>Balizador Cil√≠ndrico</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="balizador_cilindrico">-</button>
            <input type="number" name="balizador_cilindrico" min="0" value="0">
            <button type="button" class="increment" data-field="balizador_cilindrico">+</button>
          </div>
        </div>
        <div class="material-card">
          <label>Balizador C√¥nico</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="balizador_conico">-</button>
            <input type="number" name="balizador_conico" min="0" value="0">
            <button type="button" class="increment" data-field="balizador_conico">+</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="section">
      <h2 class="section-title">üìü EQUIPAMENTOS ESPECIAIS</h2>
      <div class="grid-2">
        <div class="material-card">
          <label>PMV - Painel Mensagem Vari√°vel (horas)</label>
          <input type="number" name="pmv" min="0" value="0" step="0.5" placeholder="Horas">
        </div>
        <div class="material-card">
          <label>Placa de Sinaliza√ß√£o (1m¬≤)</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="placa_1m2">-</button>
            <input type="number" name="placa_1m2" min="0" value="0">
            <button type="button" class="increment" data-field="placa_1m2">+</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="section">
      <h2 class="section-title">üë• RECURSOS HUMANOS</h2>
      <div class="grid-2">
        <div class="material-card">
          <label>Quantidade de Agentes</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="agentes">-</button>
            <input type="number" name="agentes" min="0" value="0">
            <button type="button" class="increment" data-field="agentes">+</button>
          </div>
        </div>
        <div class="material-card">
          <label>Horas de Atua√ß√£o</label>
          <input type="number" name="horas_agentes" min="0" value="0" step="0.5" placeholder="Horas">
        </div>
      </div>
    </div>
    
    <div class="section">
      <h2 class="section-title">üöó VE√çCULOS</h2>
      <div class="grid-2">
        <div class="material-card">
          <label>Carro (Pickup) - Quantidade</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="carro_qtd">-</button>
            <input type="number" name="carro_qtd" min="0" value="0">
            <button type="button" class="increment" data-field="carro_qtd">+</button>
          </div>
        </div>
        <div class="material-card">
          <label>Horas de Uso - Carro</label>
          <input type="number" name="carro_horas" min="0" value="0" step="0.5" placeholder="Horas">
        </div>
        <div class="material-card">
          <label>Moto - Quantidade</label>
          <div class="counter">
            <button type="button" class="decrement" data-field="moto_qtd">-</button>
            <input type="number" name="moto_qtd" min="0" value="0">
            <button type="button" class="increment" data-field="moto_qtd">+</button>
          </div>
        </div>
        <div class="material-card">
          <label>Horas de Uso - Moto</label>
          <input type="number" name="moto_horas" min="0" value="0" step="0.5" placeholder="Horas">
        </div>
      </div>
    </div>
    
    <div class="section">
      <h2 class="section-title">üìè C√ÅLCULO DE LOTA√á√ÉO</h2>
      <div class="grid-2">
        <div class="material-card">
          <label>√Årea do Evento (m¬≤)</label>
          <input type="number" name="area_m2" min="0" value="0" step="0.01" placeholder="m¬≤">
        </div>
        <div class="material-card">
          <label>Tipo de √Årea</label>
          <select name="tipo_area">
            <option value="externa">√Årea Externa/Descoberta</option>
            <option value="interna">√Årea Interna/Coberta</option>
          </select>
        </div>
      </div>
    </div>
    
    <button type="submit" id="btnEnviar">üì§ GERAR PLANILHA DE CUSTOS</button>
    <div id="mensagem"></div>
  </form>
</div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbyl3XpWMqTCVQuqFdrJbw1mXqDjLxBAhCgaMWtAu31pImRIBc8Hr546Fjk8kmFhBrCiSA/exec";

// Sistema de incremento/decremento
document.querySelectorAll('.increment').forEach(btn => {
  btn.addEventListener('click', () => {
    const field = btn.getAttribute('data-field');
    const input = document.querySelector(`[name="${field}"]`);
    input.value = parseInt(input.value) + 1;
  });
});

document.querySelectorAll('.decrement').forEach(btn => {
  btn.addEventListener('click', () => {
    const field = btn.getAttribute('data-field');
    const input = document.querySelector(`[name="${field}"]`);
    if (parseInt(input.value) > 0) {
      input.value = parseInt(input.value) - 1;
    }
  });
});

// Envio do formul√°rio
document.getElementById("formEvento").addEventListener("submit", async (e) => {
  e.preventDefault();
  
  const form = e.target;
  const mensagem = document.getElementById("mensagem");
  const btnEnviar = document.getElementById("btnEnviar");
  const textoOriginal = btnEnviar.textContent;
  
  btnEnviar.textContent = "‚è≥ Gerando planilha...";
  btnEnviar.disabled = true;
  mensagem.style.display = "none";

  const dados = {
    protocolo: form.protocolo.value,
    evento: form.evento.value,
    local: form.local.value,
    data_evento: form.data_evento.value,
    
    // Placas
    r4a: form.r4a.value || 0,
    r4b: form.r4b.value || 0,
    r6a: form.r6a.value || 0,
    r6c: form.r6c.value || 0,
    r25a: form.r25a.value || 0,
    r25b: form.r25b.value || 0,
    r3: form.r3.value || 0,
    
    // Equipamentos
    cone: form.cone.value || 0,
    cavalete: form.cavalete.value || 0,
    fita: form.fita.value || 0,
    barreira: form.barreira.value || 0,
    balizador_cilindrico: form.balizador_cilindrico.value || 0,
    balizador_conico: form.balizador_conico.value || 0,
    barreira_pantografica: form.barreira_pantografica.value || 0,
    barreira_plastica: form.barreira_plastica.value || 0,
    pilarete: form.pilarete.value || 0,
    pmv: form.pmv.value || 0,
    placa_1m2: form.placa_1m2.value || 0,
    
    // Recursos
    agentes: form.agentes.value || 0,
    horas_agentes: form.horas_agentes.value || 0,
    
    // Ve√≠culos
    carro_qtd: form.carro_qtd.value || 0,
    carro_horas: form.carro_horas.value || 0,
    moto_qtd: form.moto_qtd.value || 0,
    moto_horas: form.moto_horas.value || 0,
    
    // Lota√ß√£o
    area_m2: form.area_m2.value || 0,
    tipo_area: form.tipo_area.value
  };

  try {
    console.log("üì§ Enviando dados para planilha modelo:", dados);
    
    const response = await fetch(URL, {
      method: 'POST',
      body: JSON.stringify(dados),
      headers: {
        'Content-Type': 'application/json',
      },
    });

    const resultado = await response.json();
    console.log("‚úÖ Resposta:", resultado);
    
    if (resultado.status === "sucesso") {
      let mensagemHTML = `
        <div class="sucesso">
          <h3>‚úÖ PLANILHA GERADA COM SUCESSO!</h3>
          <p><strong>Protocolo:</strong> ${resultado.protocolo}</p>
          <p><strong>Aba criada:</strong> ${resultado.aba}</p>
          <p>A planilha de custos foi gerada com todos os c√°lculos autom√°ticos.</p>
          <a href="${resultado.link}" target="_blank" class="link-planilha">
            üìä ABRIR PLANILHA COMPLETA
          </a>
          <p style="margin-top: 15px; font-size: 14px;">
            <em>Os c√°lculos de custo j√° est√£o aplicados automaticamente na planilha.</em>
          </p>
        </div>
      `;
      
      mensagem.innerHTML = mensagemHTML;
      mensagem.style.display = "block";
      
      // N√£o limpar o formul√°rio completamente, apenas alguns campos
      form.evento.value = '';
      form.local.value = '';
      
      // Incrementar protocolo para pr√≥ximo evento
      const protocoloAtual = dados.protocolo;
      if (protocoloAtual.match(/EV-(\d{4})-(\d+)/)) {
        const match = protocoloAtual.match(/EV-(\d{4})-(\d+)/);
        const ano = match[1];
        const num = parseInt(match[2]);
        form.protocolo.value = `EV-${ano}-${(num + 1).toString().padStart(3, '0')}`;
      }
      
    } else {
      throw new Error(resultado.mensagem || "Erro ao gerar planilha");
    }

  } catch (err) {
    console.error("‚ùå Erro:", err);
    
    mensagem.innerHTML = `
      <div class="erro">
        <h3>‚ùå ERRO AO GERAR PLANILHA</h3>
        <p>${err.message}</p>
        <p style="margin-top: 15px; font-size: 14px;">
          Verifique se a planilha modelo est√° acess√≠vel e tente novamente.
        </p>
      </div>
    `;
    mensagem.style.display = "block";
    
  } finally {
    btnEnviar.textContent = textoOriginal;
    btnEnviar.disabled = false;
  }
});

// Configura√ß√£o inicial
window.addEventListener('load', () => {
  const hoje = new Date().toISOString().split('T')[0];
  document.querySelector('input[name="data_evento"]').value = hoje;
  
  const protocoloInput = document.querySelector('input[name="protocolo"]');
  if (!protocoloInput.value) {
    const ano = new Date().getFullYear();
    const mes = (new Date().getMonth() + 1).toString().padStart(2, '0');
    protocoloInput.value = `EV-${ano}-${mes}-001`;
  }
});
</script>

</body>
</html>
